name: Deploy

on:
  push:
    branches:
      - 'main'

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Install sshpass
        run: sudo apt-get update && sudo apt-get install -y sshpass

      - name: Deploy to server
        run: |
          sshpass -p "${{ secrets.DEPLOY_PASSWORD }}" \
            ssh -tt -o StrictHostKeyChecking=no -p "{{ vars.DEPLOY_PORT }}" \
            "${{ vars.DEPLOY_USER }}@${{ vars.DEPLOY_HOST }}" \
            'bash -lc "
              set -e
              cd nmasalkin
              git pull --no-rebase origin main
              npm ci || npm install
              npm run build
            "'
